@namespace DevToys.Blazor.Components
@using DevToys.Core.Tools.ViewItems;
@using DevToys.Core;

@inherits JSStyledComponentBase
@typeparam TElement
@typeparam TSearchElement

<CascadingValue Name="ParentIsEnabled" Value="@IsActuallyEnabled">
    <div id=@Id
         class="nav-bar-root @(_sidebarState.NavBarClassNames) @(FinalCssClasses)"
         style="@(Style)"
    @ref=Element
    @attributes="AdditionalAttributes">

        <!-- Header -->
        <div class="nav-bar-header">
            <StackPanel Orientation="UIOrientation.Horizontal"
                        HorizontalAlignment="UIHorizontalAlignment.Left">
                <Button Appearance="ButtonAppearance.Stealth"
                        Class="nav-bar-button-icon"
                        Height="36"
                        Width="40"
                        MarginTop="5"
                        MarginRight="0"
                        MarginBottom="0"
                        MarginLeft="5"
                        IsEnabled="@CanGoBack"
                        title="Back"
                        aria-label="Back"
                        @onclick="OnBackButtonClicked">
                    <FontIcon Glyph="@('\uF15B')" />
                </Button>
                <Button Appearance="ButtonAppearance.Stealth"
                        Class="nav-bar-button-icon"
                        Height="36"
                        Width="40"
                        MarginTop="5"
                        MarginRight="0"
                        MarginBottom="0"
                        MarginLeft="0"
                        IsVisible="@_sidebarState.IsHidden"
                        title="Toggle Navigation"
                        aria-label="Toggle Navigation"
                        aria-controls="@NavId"
                        aria-expanded="@_sidebarState.IsCollapsed"
                        @onclick="OnToggleSidebarClick">
                    <FontIcon Glyph="@('\uE85F')" />
                </Button>

                <div style="margin-left: 4px; display: inline;">
                    @Header
                </div>
            </StackPanel>
        </div>

        <!-- Sidebar -->
        <nav id="@NavId" class="@(_sidebarState.NavBarClassNames)">
            <StackPanel Class="sidebar-header"
                        Orientation="UIOrientation.Vertical">
                @* TODO: Localize *@
                <Button Appearance="ButtonAppearance.Stealth"
                        Class="nav-bar-button-icon"
                        HorizontalAlignment="UIHorizontalAlignment.Left"
                        Height="36"
                        Width="40"
                        MarginTop="0"
                        MarginRight="4"
                        MarginBottom="0"
                        MarginLeft="5"
                        IsVisible="@(!_sidebarState.IsHidden)"
                        title="Toggle Navigation"
                        aria-label="Toggle Navigation"
                        aria-controls="@NavId"
                        aria-expanded="@_sidebarState.IsCollapsed"
                        @onclick="OnToggleSidebarClick">
                    <FontIcon Glyph="@('\uE85F')" />
                </Button>

                <Button Appearance="ButtonAppearance.Stealth"
                        Class="nav-bar-button-icon"
                        HorizontalAlignment="UIHorizontalAlignment.Left"
                        Height="36"
                        Width="40"
                        MarginTop="6"
                        MarginRight="4"
                        MarginBottom="8"
                        MarginLeft="5"
                        IsVisible="@_sidebarState.IsCollapsed"
                        title="Click to search"
                        aria-label="Search"
                        @onclick="OnSearchButtonClick">
                    <FontIcon Glyph="@('\uF68F')" />
                </Button>
                <AutoSuggestBox @ref="_autoSuggestBox"
                                MarginTop="6"
                                MarginRight="17"
                                MarginBottom="12"
                                MarginLeft="16"
                                IsVisible="@(!_sidebarState.IsCollapsed)"
                                Placeholder="@SearchBarPlaceholder"
                                QueryChanged="@SearchQueryChanged"
                                QuerySubmitted="@SearchQuerySubmitted"
                                Items="@SearchResultItems"
                                ItemTemplate="@SearchResultItemTemplate">
                </AutoSuggestBox>
            </StackPanel>
            <div class="sidebar-body">
                <ScrollViewer Orientation="UIOrientation.Vertical">
                    <ul class="sidebar-items" role="listbox">
                        @if (MenuItemsSource is not null)
                        {
                            @foreach (TElement item in MenuItemsSource)
                            {
                                <NavBarItem Item="item"
                                            OwnerNavBar="@this"
                                            TElement="TElement"
                                            TSearchElement="TSearchElement"
                                            TitleTemplate="NavBarItemTitleTemplate"
                                            IconTemplate="NavBarItemIconTemplate"
                                            Children="item is IGroup itemGroup ? itemGroup.ChildrenItems : null"
                                            OnSelected="OnItemSelectedAsync" />
                            }
                        }
                    </ul>
                </ScrollViewer>
            </div>
            <div class="sidebar-footer">
                <ul class="sidebar-items" role="listbox">
                    @if (FooterMenuItemsSource is not null)
                    {
                        <li class="sidebar-item-separator"
                            style="margin-top: 0px;"
                            role="separator" />
                        @foreach (TElement item in FooterMenuItemsSource)
                        {
                            <NavBarItem Item="item"
                                        OwnerNavBar="@this"
                                        TElement="TElement"
                                        TSearchElement="TSearchElement"
                                        TitleTemplate="NavBarItemTitleTemplate"
                                        IconTemplate="NavBarItemIconTemplate"
                                        Children="item is IGroup itemGroup ? itemGroup.ChildrenItems : null"
                                        OnSelected="OnItemSelectedAsync" />
                        }
                    }
                </ul>
            </div>
        </nav>

        <!-- Content of the nav bar -->
        <main>
            <Container>
                @Content
            </Container>
        </main>

        <!-- A transparent clickable area that appears when the sidebar is expanded overlay. Clicking on it will close the sidebar. -->
        <Overlay Visible="_sidebarState.IsExpandedOverlay"
                 ZIndex="@(10_000 - 1)"
                 OnClick="OnCloseExpandedOverlaySidebarClick" />
    </div>
</CascadingValue>